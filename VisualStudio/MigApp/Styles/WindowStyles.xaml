<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
                    xmlns:windows="clr-namespace:System.Windows;assembly=PresentationFramework"
                    xmlns:helpers="clr-namespace:MigApp.Helpers">

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!--            ОСНОВНОЙ СТИЛЬ ОКНА (CUSTOM WINDOW)                -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <Style x:Key="CustomWindowStyle" TargetType="Window">
        <!-- Убираем системную рамку -->
        <Setter Property="WindowStyle" Value="None"/>
        <Setter Property="ResizeMode" Value="CanResize"/>
        <Setter Property="Background" Value="{StaticResource DarkBackgroundBrush}"/>
        <Setter Property="AllowsTransparency" Value="False"/>

        <!-- WindowChrome для перетаскивания и resize -->
        <Setter Property="WindowChrome.WindowChrome">
            <Setter.Value>
                <WindowChrome CaptionHeight="40"
                    CornerRadius="8"
                    ResizeBorderThickness="6"
                    GlassFrameThickness="0"/>
            </Setter.Value>
        </Setter>

        <!-- Шаблон окна -->
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Window">
                    <!-- Внешняя рамка: убираем левый Margin, оставляем сверху/справа/снизу -->
                    <Border Background="{TemplateBinding Background}"
                            CornerRadius="8"
                            Margin="0,10,10,10">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="20" ShadowDepth="1" Opacity="0.4" Color="#80000000"/>
                        </Border.Effect>

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="40"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- HEADER BAR -->
                            <Grid Grid.Row="0" Background="{StaticResource DarkSecondaryBrush}" x:Name="PART_HeaderBar">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="{TemplateBinding Title}" Style="{StaticResource H2}" VerticalAlignment="Center" Margin="12,0"/>
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <Button Style="{StaticResource IconButton}" Content="Minimize" Command="SystemCommands.MinimizeWindowCommand" CommandTarget="{Binding RelativeSource={RelativeSource AncestorType=Window}}"/>
                                    <Button Style="{StaticResource IconButton}" Content="Maximize" Command="SystemCommands.MaximizeWindowCommand" CommandTarget="{Binding RelativeSource={RelativeSource AncestorType=Window}}"/>
                                    <Button Style="{StaticResource IconButton}" Content="Close" Command="SystemCommands.CloseWindowCommand" CommandTarget="{Binding RelativeSource={RelativeSource AncestorType=Window}}"/>
                                </StackPanel>
                            </Grid>

                            <!-- КОНТЕНТ ОКНА -->
                            <ContentPresenter Grid.Row="1"/>
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!--                     СТИЛИ ТЕКСТА ОКНА                          -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <Style x:Key="WindowTitleText" TargetType="TextBlock">
        <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
        <Setter Property="FontSize" Value="16"/>
        <Setter Property="FontWeight" Value="SemiBold"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
        <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
    </Style>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!--                     КНОПКИ УПРАВЛЕНИЯ ОКНОМ                   -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <!-- Базовый стиль кнопки управления окном -->
    <Style x:Key="WindowControlButton" TargetType="Button">
        <Setter Property="Background" Value="{DynamicResource TransparentBrush}"/>
        <Setter Property="BorderBrush" Value="{DynamicResource TransparentBrush}"/>
        <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
        <Setter Property="Width" Value="40"/>
        <Setter Property="Height" Value="30"/>
        <Setter Property="Cursor" Value="Hand"/>
        <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True"/>
        <Setter Property="Focusable" Value="False"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Grid>
                        <Border x:Name="ButtonBackground"
                                Background="{TemplateBinding Background}"
                                CornerRadius="2">
                            <ContentPresenter x:Name="ContentPresenter"
                                            Content="{TemplateBinding Content}"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="ButtonBackground" Property="Background" Value="{DynamicResource MediumBackgroundBrush}"/>
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="ButtonBackground" Property="Background" Value="{DynamicResource LighterBackgroundBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Кнопка сворачивания -->
    <Style x:Key="MinimizeWindowButton" TargetType="Button" BasedOn="{StaticResource WindowControlButton}">
        <Setter Property="Content">
            <Setter.Value>
                <materialDesign:PackIcon Kind="WindowMinimize" Width="14" Height="14"/>
            </Setter.Value>
        </Setter>
        <Setter Property="ToolTip" Value="Свернуть"/>
    </Style>

    <!-- Кнопка разворачивания -->
    <Style x:Key="MaximizeWindowButton" TargetType="Button" BasedOn="{StaticResource WindowControlButton}">
        <Setter Property="Content">
            <Setter.Value>
                <materialDesign:PackIcon x:Name="MaximizeIcon" Kind="WindowMaximize" Width="12" Height="12"/>
            </Setter.Value>
        </Setter>
        <Setter Property="ToolTip" Value="Развернуть"/>
        <Style.Triggers>
            <DataTrigger Binding="{Binding WindowState, RelativeSource={RelativeSource AncestorType=Window}}" Value="Maximized">
                <Setter Property="ToolTip" Value="Восстановить"/>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <!-- Кнопка закрытия -->
    <Style x:Key="CloseWindowButton" TargetType="Button" BasedOn="{StaticResource WindowControlButton}">
        <Setter Property="Content">
            <Setter.Value>
                <materialDesign:PackIcon Kind="Close" Width="14" Height="14"/>
            </Setter.Value>
        </Setter>
        <Setter Property="ToolTip" Value="Закрыть"/>
        <Setter Property="Background" Value="{DynamicResource TransparentBrush}"/>
        <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
        <Style.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Background" Value="#E81123"/>
                <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
            </Trigger>
        </Style.Triggers>
    </Style>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!--                     МОДАЛЬНЫЕ ОКНА                             -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <Style x:Key="ModalWindowStyle" TargetType="Window" BasedOn="{StaticResource CustomWindowStyle}">
        <Setter Property="Width" Value="500"/>
        <Setter Property="Height" Value="400"/>
        <Setter Property="SizeToContent" Value="Manual"/>
        <Setter Property="ResizeMode" Value="NoResize"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Window">
                    <Grid>
                        <!-- Затемнение фона -->
                        <Border Background="#80000000"/>

                        <!-- Контент модального окна -->
                        <Border Background="{DynamicResource DarkBackgroundBrush}"
                                CornerRadius="8"
                                Width="{TemplateBinding Width}"
                                Height="{TemplateBinding Height}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="20"
                                                ShadowDepth="1"
                                                Opacity="0.3"
                                                Color="Black"/>
                            </Border.Effect>

                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Заголовок -->
                                <Border Grid.Row="0"
                                        Background="{DynamicResource PrimaryBrush}"
                                        CornerRadius="8 8 0 0"
                                        Height="40">
                                    <Grid>
                                        <TextBlock Text="{TemplateBinding Title}"
                                                  Foreground="White"
                                                  FontSize="16"
                                                  FontWeight="SemiBold"
                                                  Margin="16 0"
                                                  VerticalAlignment="Center"/>

                                        <Button x:Name="CloseButton"
                                                Style="{StaticResource CloseWindowButton}"
                                                HorizontalAlignment="Right"
                                                Command="{Binding Source={x:Static helpers:WindowCommands.CloseCommand}}"
                                                CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                                Foreground="White"/>
                                    </Grid>
                                </Border>

                                <!-- Основное содержимое -->
                                <ContentPresenter Grid.Row="1"
                                                Margin="16"/>

                                <!-- Кнопки действий -->
                                <!--<StackPanel Grid.Row="2"
                                            Orientation="Horizontal"
                                            HorizontalAlignment="Right"
                                            Margin="0 0 16 16">
                                    <Button Content="Отмена"
                                            Style="{StaticResource DialogButton}"
                                            Click="OnCancelClick"/>
                                    <Button Content="OK"
                                            Style="{StaticResource DialogPrimaryButton}"
                                            Margin="8 0 0 0"
                                            Click="OnOkClick"/>
                                </StackPanel>-->
                            </Grid>
                        </Border>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!--                     КНОПКИ ДИАЛОГОВЫХ ОКОН                    -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <Style x:Key="DialogButton" TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
        <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
        <Setter Property="Background" Value="{DynamicResource TransparentBrush}"/>
        <Setter Property="MinWidth" Value="80"/>
        <Setter Property="Margin" Value="0 0 8 0"/>
    </Style>

    <Style x:Key="DialogPrimaryButton" TargetType="Button" BasedOn="{StaticResource DialogButton}">
        <Setter Property="Background" Value="{DynamicResource PrimaryBrush}"/>
        <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
    </Style>

</ResourceDictionary>